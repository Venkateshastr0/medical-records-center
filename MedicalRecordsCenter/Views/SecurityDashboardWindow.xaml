<UserControl x:Class="MedicalRecordsCenter.Views.SecurityDashboardWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             Background="{StaticResource BackgroundBrush}">
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource SurfaceBrush}" 
                BorderBrush="#E0E0E0" 
                BorderThickness="0,0,0,1"
                Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Security" 
                                            Foreground="{StaticResource PrimaryBrush}"
                                            Width="24" 
                                            Height="24"
                                            VerticalAlignment="Center"
                                            Margin="0,0,10,0" />
                    <TextBlock Text="Security Dashboard" 
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="20"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               VerticalAlignment="Center" />
                </StackPanel>

                <!-- Last Refresh -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Text="Last Refresh: " 
                               FontFamily="{StaticResource UbuntuFont}"
                               FontSize="12"
                               Foreground="#666"
                               VerticalAlignment="Center" />
                    <TextBlock Text="{Binding LastRefresh, StringFormat='yyyy-MM-dd HH:mm:ss'}" 
                               FontFamily="{StaticResource UbuntuFont}"
                               FontSize="12"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               VerticalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Statistics Cards -->
        <Grid Grid.Row="1" Margin="20,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Total Users -->
            <Border Grid.Column="0"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Padding="15"
                    Margin="0,0,10,0">
                <StackPanel>
                    <materialDesign:PackIcon Kind="AccountMultiple" 
                                            Foreground="{StaticResource PrimaryBrush}"
                                            Width="24" 
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            Margin="0,0,0,10" />
                    <TextBlock Text="{Binding TotalUsers}"
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="24"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="Total Users"
                               FontFamily="{StaticResource UbuntuFont}"
                               FontSize="12"
                               Foreground="#666"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Border>

            <!-- Active Users -->
            <Border Grid.Column="1"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Padding="15"
                    Margin="5,0">
                <StackPanel>
                    <materialDesign:PackIcon Kind="AccountCheck" 
                                            Foreground="{StaticResource SuccessBrush}"
                                            Width="24" 
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            Margin="0,0,0,10" />
                    <TextBlock Text="{Binding ActiveUsersCount}"
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="24"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="Active Users"
                               FontFamily="{StaticResource UbuntuFont}"
                               FontSize="12"
                               Foreground="#666"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Border>

            <!-- Failed Logins -->
            <Border Grid.Column="2"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Padding="15"
                    Margin="5,0">
                <StackPanel>
                    <materialDesign:PackIcon Kind="Alert" 
                                            Foreground="{StaticResource WarningBrush}"
                                            Width="24" 
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            Margin="0,0,0,10" />
                    <TextBlock Text="{Binding FailedLoginsCount}"
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="24"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="Failed Logins"
                               FontFamily="{StaticResource UbuntuFont}"
                               FontSize="12"
                               Foreground="#666"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Border>

            <!-- Critical Events -->
            <Border Grid.Column="3"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Padding="15"
                    Margin="10,0,0,0">
                <StackPanel>
                    <materialDesign:PackIcon Kind="AlertCircle" 
                                            Foreground="{StaticResource ErrorBrush}"
                                            Width="24" 
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            Margin="0,0,0,10" />
                    <TextBlock Text="{Binding CriticalEventsCount}"
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="24"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="Critical Events"
                               FontFamily="{StaticResource UbuntuFont}"
                               FontSize="12"
                               Foreground="#666"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Security Events -->
        <Grid Grid.Row="2" Margin="20,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Recent Audit Logs -->
            <Border Grid.Column="0"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Padding="15"
                    Margin="0,0,10,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="Recent Activity"
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="14"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               Margin="0,0,0,10" />

                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding RecentAuditLogs}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             MaxHeight="300">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="5" Margin="0,2">
                                    <StackPanel>
                                        <TextBlock Text="{Binding ActionDisplay}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="#0d171c" />
                                        <TextBlock Text="{Binding UserName}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="10"
                                                   Foreground="#666" />
                                        <TextBlock Text="{Binding Timestamp, StringFormat='HH:mm:ss'}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="10"
                                                   Foreground="#999" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- Failed Logins -->
            <Border Grid.Column="1"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Padding="15"
                    Margin="5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="Failed Login Attempts"
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="14"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               Margin="0,0,0,10" />

                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding FailedLogins}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             MaxHeight="300">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="5" Margin="0,2">
                                    <StackPanel>
                                        <TextBlock Text="{Binding UserName}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="#0d171c" />
                                        <TextBlock Text="{Binding Description}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="10"
                                                   Foreground="#666" />
                                        <TextBlock Text="{Binding Timestamp, StringFormat='HH:mm:ss'}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="10"
                                                   Foreground="#999" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- Critical Events -->
            <Border Grid.Column="2"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Padding="15"
                    Margin="10,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="Critical Security Events"
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="14"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               Margin="0,0,0,10" />

                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding CriticalEvents}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             MaxHeight="300">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="5" Margin="0,2">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Action}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="12"
                                                   FontWeight="Medium"
                                                   Foreground="#0d171c" />
                                        <TextBlock Text="{Binding Description}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="10"
                                                   Foreground="#666" />
                                        <TextBlock Text="{Binding Timestamp, StringFormat='HH:mm:ss'}"
                                                   FontFamily="{StaticResource UbuntuFont}"
                                                   FontSize="10"
                                                   Foreground="#999" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Grid Grid.Row="2" 
              Background="#80000000"
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                             IsIndeterminate="True"
                             Width="50"
                             Height="50"
                             Margin="0,0,0,20" />
                <TextBlock Text="Loading Security Data..."
                           FontFamily="{StaticResource UbuntuFont}"
                           FontSize="16"
                           Foreground="White"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Grid>

        <!-- Action Bar -->
        <Border Grid.Row="3" 
                Background="{StaticResource SurfaceBrush}" 
                BorderBrush="#E0E0E0" 
                BorderThickness="0,1,0,0"
                Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Status Message -->
                <TextBlock Grid.Column="0"
                           Text="{Binding StatusMessage}"
                           FontFamily="{StaticResource UbuntuFont}"
                           FontSize="12"
                           Foreground="#666"
                           VerticalAlignment="Center" />

                <!-- Security Actions -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Command="{Binding RefreshDashboardCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Margin="0,0,10,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Refresh" 
                                                    Width="16" 
                                                    Height="16"
                                                    Margin="0,0,5,0" />
                            <TextBlock Text="Refresh" />
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding ExportSecurityReportCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Margin="0,0,10,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Download" 
                                                    Width="16" 
                                                    Height="16"
                                                    Margin="0,0,5,0" />
                            <TextBlock Text="Export Report" />
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding CleanupOldAuditLogsCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Foreground="{StaticResource WarningBrush}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Delete" 
                                                    Width="16" 
                                                    Height="16"
                                                    MaterialDesign:Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"
                                                    Margin="0,0,5,0" />
                            <TextBlock Text="Cleanup Logs" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>

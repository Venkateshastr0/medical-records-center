<UserControl x:Class="MedicalRecordsCenter.Views.PatientManagementWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             Background="{StaticResource BackgroundBrush}">
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource SurfaceBrush}" 
                BorderBrush="#E0E0E0" 
                BorderThickness="0,0,0,1"
                Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="AccountMultiple" 
                                            Foreground="{StaticResource PrimaryBrush}"
                                            Width="24" 
                                            Height="24"
                                            VerticalAlignment="Center"
                                            Margin="0,0,10,0" />
                    <TextBlock Text="Patient Management" 
                               FontFamily="{StaticResource UbuntuMediumFont}"
                               FontSize="20"
                               FontWeight="Medium"
                               Foreground="#0d171c"
                               VerticalAlignment="Center" />
                </StackPanel>

                <!-- Statistics -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Border Background="{StaticResource PrimaryBrush}" 
                            CornerRadius="15" 
                            Padding="10,5">
                        <TextBlock Text="{Binding TotalPatients, StringFormat='Total: {0}'}" 
                                   FontFamily="{StaticResource UbuntuMediumFont}"
                                   FontSize="12"
                                   FontWeight="Medium"
                                   Foreground="White" />
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Search and Filter Bar -->
        <Border Grid.Row="1" 
                Background="{StaticResource SurfaceBrush}" 
                BorderBrush="#E0E0E0" 
                BorderThickness="0,0,0,1"
                Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <TextBox Grid.Column="0"
                         materialDesign:HintAssist.Hint="Search patients..."
                         materialDesign:HintAssist.IsFloating="True"
                         materialDesign:TextFieldAssist.LeadingIcon="Magnify"
                         Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}"
                         FontFamily="{StaticResource UbuntuFont}"
                         FontSize="14"
                         Margin="0,0,15,0" />

                <!-- Filter Dropdown -->
                <ComboBox Grid.Column="1"
                          materialDesign:HintAssist.Hint="Filter"
                          ItemsSource="{Binding FilterOptions}"
                          SelectedItem="{Binding FilterStatus}"
                          FontFamily="{StaticResource UbuntuFont}"
                          FontSize="14"
                          Margin="0,0,15,0" />

                <!-- Apply Filter Button -->
                <Button Grid.Column="2"
                        Command="{Binding ApplyFilterCommand}"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        FontFamily="{StaticResource UbuntuFont}"
                        FontSize="14"
                        Margin="0,0,15,0">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Filter" 
                                                Width="16" 
                                                Height="16"
                                                Margin="0,0,5,0" />
                        <TextBlock Text="Apply Filter" />
                    </StackPanel>
                </Button>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="3" Orientation="Horizontal">
                    <Button Command="{Binding RefreshPatientsCommand}"
                            Style="{StaticResource MaterialDesignIconButton}"
                            ToolTip="Refresh"
                            Margin="0,0,10,0">
                        <materialDesign:PackIcon Kind="Refresh" />
                    </Button>
                    <Button Command="{Binding AddPatientCommand}"
                            Style="{StaticResource MaterialDesignIconButton}"
                            ToolTip="Add Patient"
                            Background="{StaticResource PrimaryBrush}"
                            Foreground="White">
                        <materialDesign:PackIcon Kind="Plus" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Patient List -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding Patients}"
                  SelectedItem="{Binding SelectedPatient}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="True"
                  CanUserResizeColumns="True"
                  CanUserResizeRows="False"
                  CanUserSortColumns="True"
                  GridLinesVisibility="Horizontal"
                  HorizontalGridLinesBrush="#E0E0E0"
                  VerticalGridLinesBrush="Transparent"
                  Background="White"
                  FontFamily="{StaticResource UbuntuFont}"
                  FontSize="14"
                  Margin="20,15,20,0">
            
            <DataGrid.Resources>
                <Style TargetType="DataGridRow">
                    <Setter Property="Height" Value="45" />
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#F5F5F5" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#E3F2FD" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <!-- Name -->
                <DataGridTextColumn Header="Name" 
                                    Binding="{Binding FullName}"
                                    Width="200"
                                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="FontWeight" Value="Medium" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Date of Birth -->
                <DataGridTextColumn Header="Date of Birth" 
                                    Binding="{Binding DateOfBirth}"
                                    Width="120"
                                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Age -->
                <DataGridTextColumn Header="Age" 
                                    Binding="{Binding Age}"
                                    Width="60"
                                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Gender -->
                <DataGridTextColumn Header="Gender" 
                                    Binding="{Binding Gender}"
                                    Width="80"
                                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Phone -->
                <DataGridTextColumn Header="Phone" 
                                    Binding="{Binding PhoneNumber}"
                                    Width="120"
                                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Email -->
                <DataGridTextColumn Header="Email" 
                                    Binding="{Binding Email}"
                                    Width="200"
                                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Blood Type -->
                <DataGridTextColumn Header="Blood Type" 
                                    Binding="{Binding BloodType}"
                                    Width="100"
                                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="FontWeight" Value="Medium" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Created Date -->
                <DataGridTextColumn Header="Created" 
                                    Binding="{Binding CreatedAt, StringFormat='yyyy-MM-dd'}"
                                    Width="100"
                                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Loading Overlay -->
        <Grid Grid.Row="2" 
              Background="#80000000"
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                             IsIndeterminate="True"
                             Width="50"
                             Height="50"
                             Margin="0,0,0,20" />
                <TextBlock Text="Loading..."
                           FontFamily="{StaticResource UbuntuFont}"
                           FontSize="16"
                           Foreground="White"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Grid>

        <!-- Action Bar -->
        <Border Grid.Row="3" 
                Background="{StaticResource SurfaceBrush}" 
                BorderBrush="#E0E0E0" 
                BorderThickness="0,1,0,0"
                Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Status Message -->
                <TextBlock Grid.Column="0"
                           Text="{Binding StatusMessage}"
                           FontFamily="{StaticResource UbuntuFont}"
                           FontSize="12"
                           Foreground="#666"
                           VerticalAlignment="Center" />

                <!-- Patient Actions -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Command="{Binding ViewPatientDetailsCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            IsEnabled="{Binding SelectedPatient, Converter={StaticResource NullToBooleanConverter}}"
                            Margin="0,0,10,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Eye" 
                                                    Width="16" 
                                                    Height="16"
                                                    Margin="0,0,5,0" />
                            <TextBlock Text="View Details" />
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding EditPatientCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            IsEnabled="{Binding SelectedPatient, Converter={StaticResource NullToBooleanConverter}}"
                            Margin="0,0,10,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Edit" 
                                                    Width="16" 
                                                    Height="16"
                                                    Margin="0,0,5,0" />
                            <TextBlock Text="Edit" />
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding DeletePatientCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            IsEnabled="{Binding SelectedPatient, Converter={StaticResource NullToBooleanConverter}}"
                            Foreground="{StaticResource ErrorBrush}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Delete" 
                                                    Width="16" 
                                                    Height="16"
                                                    MaterialDesign:Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"
                                                    Margin="0,0,5,0" />
                            <TextBlock Text="Delete" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
